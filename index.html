<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rod Selection</title>
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
body { 
    font-family: 'Roboto', sans-serif; 
    margin: 0; 
    padding: 20px; 
    background-color: #f5f7fa; 
    color: #333;
}

h2 {
    font-family: 'Roboto', sans-serif;
    font-weight: 700;
    font-size: 2em;
    text-align: center;
    margin-bottom: 20px;
    color: #2c3e50;
}

#loading {
    width: 100%; 
    background-color: #ddd; 
    margin-bottom: 15px; 
    border-radius: 5px;
    overflow: hidden;
}

#loadingBar { 
    width: 0%; 
    height: 20px; 
    background-color: #4CAF50; 
    text-align: center; 
    color: white; 
    line-height: 20px; 
    transition: width 0.3s ease;
}

#filters { 
    display: flex; 
    flex-wrap: wrap; 
    gap: 20px; 
    max-width: 1000px; 
    margin: 0 auto 20px auto;
}

.filter-column { 
    flex: 1; 
    min-width: 200px; 
    background-color: #ffffff;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 1px 5px rgba(0,0,0,0.1);
}

.filter-column label { 
    font-weight: bold; 
    display: block; 
    margin-bottom: 5px; 
    margin-top: 10px; 
}

.checkbox-group { 
    display: grid; 
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); 
    gap: 5px; 
    max-height: 250px; 
    overflow-y: auto; 
    padding: 5px; 
    border: 1px solid #ccc; 
    border-radius: 5px;
    background-color: #f9f9f9;
}

table { 
    border-collapse: collapse; 
    width: 100%; 
    margin-top: 10px; 
    table-layout: auto; 
    background-color: #fff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 1px 5px rgba(0,0,0,0.1);
}

th, td { 
    border: 1px solid #ccc; 
    padding: 8px; 
    text-align: left; 
    white-space: nowrap; 
    overflow: hidden; 
    text-overflow: ellipsis; 
}

th { 
    background-color: #3498db; 
    color: white; 
}

</style>
</head>
<body>

<h2>Rod Selection</h2>

<div id="loading">
  <div id="loadingBar">Loading...</div>
</div>

<div id="filters">
  <div class="filter-column" id="col1"></div>
  <div class="filter-column" id="col2"></div>
</div>

<table id="rodTable">
  <thead>
    <tr id="tableHeader"></tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<script>
// --- JSON URL ---
const jsonURL = "https://raw.githubusercontent.com/MeefahOnline/Rod-Database/main/Rod%20Data.json";

const loading = document.getElementById("loading");
const loadingBar = document.getElementById("loadingBar");
loading.style.display = "block";
loadingBar.style.width = "0%";

// Filter factors
const factors = [
  { name: "Brand", key: "Brand" },
  { name: "Type", key: "Type" },
  { name: "Reel Type", key: "Reel Type" },
  { name: "Length", key: "Length" },
  { name: "Joint Type", key: "Joint Type" },
  { name: "Power", key: "Power" },
  { name: "Action", key: "Action" },
  { name: "Material", key: "Material" },
  { name: "Ring", key: "Ring" },
  { name: "Reel Seat", key: "Reel Seat" },
  { name: "Warranty", key: "Warranty" }
];

let tableData = [];
let filtersData = {};

fetch(jsonURL)
  .then(res => res.json())
  .then(data => {
    tableData = data;
    loadingBar.style.width = "100%";
    loading.style.display = "none";

    // Table header
    const tableHeader = document.getElementById("tableHeader");
    tableHeader.innerHTML = Object.keys(tableData[0] || {}).map(k => "<th>"+k+"</th>").join("");

    // Build filters
    factors.forEach(f => {
      filtersData[f.name] = new Set();
      tableData.forEach(row => {
        const val = row[f.key]?.trim();
        if(val && val !== "0") filtersData[f.name].add(val);
      });
    });

    // Generate checkboxes
    const col1 = document.getElementById("col1");
    const col2 = document.getElementById("col2");

    factors.forEach((f,i) => {
      const container = document.createElement("div");
      container.innerHTML = `<label>${f.name}:</label>`;
      const group = document.createElement("div");
      group.className = "checkbox-group";

      Array.from(filtersData[f.name]).sort().forEach(val => {
        const id = f.name+"_"+val.replace(/\s+/g,"_");
        group.innerHTML += `<label><input type="checkbox" class="filter-checkbox" data-factor="${f.name}" value="${val}" id="${id}"> ${val}</label>`;
      });

      container.appendChild(group);
      (i < Math.ceil(factors.length/2) ? col1 : col2).appendChild(container);
    });

    document.querySelectorAll(".filter-checkbox").forEach(cb => cb.addEventListener("change", renderTable));

    renderTable();
  })
  .catch(err => {
    console.error("Failed to load JSON:", err);
    loadingBar.style.backgroundColor = "red";
    loadingBar.textContent = "Failed to load database!";
  });

// --- Render table ---
function renderTable() {
  const selected = {};
  factors.forEach(f => {
    const checked = Array.from(document.querySelectorAll(`.filter-checkbox[data-factor="${f.name}"]:checked`))
                        .map(cb => cb.value);
    selected[f.name] = checked;
  });

  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = "";

  tableData.forEach(row => {
    const match = factors.every(f => {
      if(selected[f.name].length === 0) return true;
      return selected[f.name].includes(row[f.key]);
    });
    if(match) {
      tbody.innerHTML += "<tr>" + Object.values(row).map(c => "<td>"+c+"</td>").join("") + "</tr>";
    }
  });
}
</script>
</body>
</html>
