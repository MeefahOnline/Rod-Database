<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rod Selection</title>
<style>
body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background-color: #f9f9f9;
    margin: 20px;
}
h2 {
    font-family: 'Verdana', sans-serif;
    color: #333;
}
#loading {
    width: 100%;
    background-color: #eee;
    margin-bottom: 10px;
}
#loadingBar {
    width: 0%;
    height: 20px;
    background-color: #4CAF50;
    text-align: center;
    color: white;
    line-height: 20px;
}
#filters {
    display: flex;
    gap: 20px;
    max-width: 1200px;
}
.filter-column {
    flex: 1;
    min-width: 250px;
}
.checkbox-group {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 5px;
    max-height: 250px;
    overflow-y: auto;
    border: 1px solid #ccc;
    padding: 5px;
    background-color: #fff;
}
table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 10px;
    table-layout: auto;
    background: #fff;
}
th, td {
    border: 1px solid #ccc;
    padding: 6px;
    text-align: left;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
th {
    background-color: #e0e0e0;
}
</style>
</head>
<body>

<h2>Rod Selection</h2>

<div id="loading">
  <div id="loadingBar">Loading...</div>
</div>

<div id="filters">
  <div class="filter-column" id="col1"></div>
  <div class="filter-column" id="col2"></div>
</div>

<table id="rodTable">
  <thead>
    <tr id="tableHeader"></tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<script>
// --- URL of your JSON uploaded to GitHub ---
const jsonURL = "https://raw.githubusercontent.com/MeefahOnline/Rod-Database/main/Rod%20Data.json";

const loading = document.getElementById("loading");
const loadingBar = document.getElementById("loadingBar");
loading.style.display = "block";
loadingBar.style.width = "0%";

// Filter factors
const factors = [
  { name: "Brand" },
  { name: "Type" },
  { name: "Reel Type" },
  { name: "Length" },
  { name: "Joint Type" },
  { name: "Power" },
  { name: "Action" },
  { name: "Material" },
  { name: "Ring" },
  { name: "Reel Seat" },
  { name: "Warranty" }
];

// Map filters to **column indices in JSON array** (0-based)
const filterColumns = [1,3,4,5,6,8,10,11,12,13,18];

let tableData = [];
let filtersData = {};

// --- Fetch JSON ---
fetch(jsonURL)
.then(res => res.json())
.then(data => {
    tableData = data;
    loadingBar.style.width = "100%";
    loading.style.display = "none";

    // Build table header dynamically
    const tableHeader = document.getElementById("tableHeader");
    tableHeader.innerHTML = Object.keys(tableData[0] || {}).map(k => "<th>"+k+"</th>").join("");

    // Build unique filter values for checkboxes, exclude zeros
    factors.forEach((f,i) => {
        filtersData[f.name] = new Set();
        tableData.forEach(row => {
            const key = Object.keys(row)[filterColumns[i]];
            let val = row[key];
            if(val) val = val.toString().trim();
            if(val && val !== "0") filtersData[f.name].add(val);
        });
    });

    // Create checkboxes in two columns
    const col1 = document.getElementById("col1");
    const col2 = document.getElementById("col2");

    factors.forEach((f,i) => {
        const container = document.createElement("div");
        container.innerHTML = `<label>${f.name}:</label>`;
        const group = document.createElement("div");
        group.className = "checkbox-group";

        Array.from(filtersData[f.name]).sort().forEach(val => {
            const id = f.name+"_"+val.replace(/\s+/g,"_");
            group.innerHTML += `<label><input type="checkbox" class="filter-checkbox" data-factor="${f.name}" value="${val}" id="${id}"> ${val}</label>`;
        });

        container.appendChild(group);
        (i < Math.ceil(factors.length/2) ? col1 : col2).appendChild(container);
    });

    // Event listeners for filtering
    document.querySelectorAll(".filter-checkbox").forEach(cb => cb.addEventListener("change", renderTable));

    // Initial render
    renderTable();
})
.catch(err => {
    console.error("Failed to load JSON:", err);
    loadingBar.style.backgroundColor = "red";
    loadingBar.textContent = "Failed to load database!";
});

// --- Render table based on selected checkboxes ---
function renderTable() {
    const selected = {};
    factors.forEach(f => {
        const checked = Array.from(document.querySelectorAll(`.filter-checkbox[data-factor="${f.name}"]:checked`))
                        .map(cb => cb.value);
        selected[f.name] = checked;
    });

    const tbody = document.getElementById("tableBody");
    tbody.innerHTML = "";

    tableData.forEach(row => {
        const match = factors.every((f,i) => {
            const key = Object.keys(row)[filterColumns[i]];
            const val = row[key]?.toString().trim();
            if(selected[f.name].length === 0) return true;
            return selected[f.name].includes(val);
        });
        if(match) {
            tbody.innerHTML += "<tr>" + Object.values(row).map(c => "<td>"+c+"</td>").join("") + "</tr>";
        }
    });
}
</script>

</body>
</html>
